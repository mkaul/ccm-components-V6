ccm.component({name:"teambuild",config:{html:[ccm.load,"http://mkaul.github.io/ccm-components/lib/jsonp/teambuild_html.json"],icons:[ccm.load,"https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"],icon:{team:"group",member:"user"},key:"demo",lang:[ccm.instance,"http://mkaul.github.io/ccm-components/lib/components/lang.js",{store:[ccm.store,"http://mkaul.github.io/ccm-components/lib/jsonp/teambuild_lang.json"]}],store:[ccm.store,{db:"redis",store:"team",url:"wss://ccm.inf.h-brs.de:8888/index.js"}],style:[ccm.load,"http://mkaul.github.io/ccm-components/lib/css/teambuild.css"],text:{free:"lang#free",join:"lang#join",leave:"lang#leave",team:"lang#team"},user:[ccm.instance,"http://kaul.inf.h-brs.de/ccm/components/user2.js",{element:"name"}]},Instance:function(){function e(){ccm.helper.isInDOM(t)&&t.render()}var t=this;this.ready=function(n){t.store.onChange=e,t.user&&t.user.addObserver(e),t.bigdata&&t.bigdata.log("ready"),n()},this.render=function(e){var n=ccm.helper.element(t);ccm.helper.dataset(t,function(m){function a(){function e(e,n){function c(e){return!!e.members[d.key]}function r(t){return void 0===e.editable?!(m.editable===!1||"object"==typeof m.editable&&m.editable[t]===!1):!(e.editable===!1||"object"==typeof e.editable&&e.editable[t]===!1)}function l(){g.find("> .header > .name").prop("contenteditable",!0).on("input",function(){u(!0);var a=jQuery(this).val().trim();m.teams[n-1].name=ccm.helper.val(a),t.store.set(m,function(){u(!1),t.bigdata&&t.bigdata.log("rename",{key:e.key,name:e.name})})})}function s(){function c(){u(!0),delete e.members[d.key],!m.max_teams&&a(e)&&m.teams.splice(n-1,1),t.store.set(m,function(){t.render(),t.bigdata&&t.bigdata.log("leave",{key:e.key})})}ccm.helper.find(t,g,".button").html(ccm.helper.html(t.html.button,{caption:ccm.helper.val(t.text.leave),click:c}))}function i(){function t(e){return e.members[d.key]&&1===Object.keys(e.members).length}return r("join")?f&&m.teams[f-1].editable===!1?!1:!m.max_teams&&n===m.teams.length&&n>1&&t(m.teams[n-2])?!1:!y||Object.keys(e.members).length<y:!1}function o(){function n(){if(u(!0),f){var n=m.teams[f-1];delete n.members[d.key],!m.max_teams&&a(n)&&m.teams.splice(f-1,1)}e.members[d.key]={key:d.key,name:d.name},t.store.set(m,function(){t.render(),t.bigdata&&t.bigdata.log("join",{key:e.key})})}ccm.helper.find(t,g,".button").html(ccm.helper.html(t.html.button,{caption:ccm.helper.val(t.text.join),click:n}))}function h(){for(var e=0;e<m.teams.length;e++)if(m.teams[e].members[d.key])return e+1;return 0}function u(e){var n=ccm.helper.find(t,g,".status");e?ccm.helper.loading(n):n.html("")}function b(){function n(e){ccm.helper.find(t,g,".members").append(ccm.helper.html(t.html.member,{icon:ccm.helper.val(t.icon.member),name:ccm.helper.val(e?e.name&&t.user?e.name:e.key:t.text.free),user:e&&d&&d.key===e.key?"user":"",free:e?"":"free"}))}for(var m in e.members)n(e.members[m]);for(;y>ccm.helper.find(t,g,".member").length;)n()}n||(n=m.teams.length);var d,f,p=e.name?e.name:t.text.team+(t.lang?"#":" ")+n,g=ccm.helper.html(t.html.team,{icon:ccm.helper.val(t.icon.team),name:ccm.helper.val(p)}),y=e.max_members||m.max_members;-1===y&&(y=null),t.user&&t.user.isLoggedIn()&&(d=t.user.data(),f=h(),c(e)?(r("rename")&&l(),r("leave")&&s()):i()&&o()),b(),ccm.helper.find(t,".teams").append(g)}function n(){var t={key:ccm.helper.generateKey(),members:{}};m.teams.push(t),e(t)}function a(e){return 0===Object.keys(e.members).length}function c(){return!(m.editable===!1||"object"==typeof m.editable&&m.editable.join===!1)}for(var r=0;r<m.teams.length;r++)e(m.teams[r],r+1);if(m.max_teams)for(;m.max_teams>ccm.helper.find(t,".team").length;)n();else 0!==m.teams.length&&a(m.teams[m.teams.length-1])||!c()||n()}m.teams||(m.teams=[]),n.html(ccm.helper.html(t.html.main)),a(),t.lang&&t.lang.render(),e&&e()})}}});