ccm.component({name:"quizz",config:{html:[ccm.load,"http://mkaul.github.io/ccm-components/dist/quizz/quizz_html.json"],key:"example",lang:[ccm.instance,"http://mkaul.github.io/ccm-components/lib/components/lang.js",{store:[ccm.store,"http://mkaul.github.io/ccm-components/dist/quizz/quizz_lang.json"]}],onAnswer:function(e){console.log(e)},onFinish:function(e){return console.log(e),e.quizz.render(),!1},store:[ccm.store,"http://mkaul.github.io/ccm-components/dist/quizz/quizz.json"],style:[ccm.load,"http://mkaul.github.io/ccm-components/dist/quizz/quizz.css"],text_answer:"lang#answer",text_correct:"lang#correct",text_finish:"lang#finish",text_next:"lang#next",text_question:"lang#question",text_result:"lang#result"},Instance:function(){var e,n,t,c,r=this;this.init=function(i){e=r.store,delete r.store,n=r.key,delete r.key,t=r.onAnswer,delete r.onAnswer,c=r.onFinish,delete r.onFinish,i&&i()},this.render=function(i){var o=ccm.helper.element(r);ccm.helper.dataset({store:e,key:n},function(e){function n(){e.title&&ccm.helper.find(r,".title").html(ccm.helper.html({inner:ccm.helper.val(e.title)}))}function s(){e.description&&ccm.helper.find(r,".description").html(ccm.helper.html({inner:ccm.helper.val(e.description)}))}function l(n){function i(){m.comment&&ccm.helper.find(r,".comment").html(ccm.helper.html({inner:ccm.helper.val(m.comment)}))}function o(e,t){function c(e){var c,o;return Array.isArray(e)?(c=e[1],o=e[0]):o=e,e={tag:"input",type:o||"checkbox",name:n+"-"+t,id:i},"radio"===o&&(e.name=n,e.value=t),ccm.helper.integrate(c,e),r.onInput&&(e.oninput=function(){r.onInput(r,jQuery(this))}),e}var i=r.index+"-"+n+"-"+t;"string"==typeof e&&(e={text:e}),void 0===e.encode&&(e.encode=m.encode),ccm.helper.find(r,".answers").append(ccm.helper.html(r.html.answer,{text:ccm.helper.val(e.text,e.encode),id:i})),ccm.helper.find(r,".answer:last .input").html(ccm.helper.html(c(m.input)))}function s(){function i(e,n){ccm.helper.find(r,e,".comment").html(ccm.helper.html({inner:ccm.helper.val(n)}))}var o=jQuery(this);if(r.onValidation&&!r.onValidation(r,o))return!1;var s,p,h,u,d,f=ccm.helper.formData(o),g={input:[],solution:[],passed:!0},v=ccm.helper.find(r,".answers"),x=n<e.questions.length;d=Array.isArray(m.input)?m.input[0]:m.input,"radio"===d&&(s=n,p=ccm.helper.find(r,'input[name="'+s+'"]').closest(".answer"),h=parseInt(f[s]),u=m.correct,g.input=h,g.solution=u,g.passed=h===u,p.addClass(g.passed?"right":"wrong"));for(var z=0;z<m.answers.length;z++){if("radio"===d)p=ccm.helper.find(r,'input[name="'+s+'"][value="'+z+'"]').closest(".answer");else{if(s=n+"-"+z,p=ccm.helper.find(r,'input[name="'+s+'"]').closest(".answer"),h="text"===d?f[s]:"number"===d?f[s]:!!f[s],Array.isArray(m.correct))if("number"==typeof m.correct[0]){u=!1;for(var w=0;w<m.correct.length;w++)m.correct[w]===z&&(u=!0)}else u=m.correct[z];else u=void 0;g.input.push(h),g.solution.push(u),h!==u&&(g.passed=!1),p.addClass(h===u?"right":"wrong")}m.answers[z].comment?i(p,m.answers[z].comment):"text"!==d&&"number"!==d||i(p,"<span>"+r.text_correct+"</span>: "+u)}return g.passed&&a.correct++,a.details.push(g),ccm.helper.find(r,"form").replaceWith(ccm.helper.html({"class":"result",inner:{inner:{tag:"button",inner:x?r.text_next:r.text_finish,onclick:x?function(){l(n+1)}:function(){c&&c(ccm.helper.integrate({quizz:r,dataset:ccm.helper.clone(e)},a))}}}})),ccm.helper.find(r,".result").prepend(v),ccm.helper.find(r,"input").attr("disabled",!0),r.lang.render(),t&&t(ccm.helper.integrate({quizz:r,dataset:ccm.helper.clone(e),nr:n},g)),m.no_feedback&&ccm.helper.find(r,"button").click(),!1}var m=e.questions[n-1];void 0===m.answers&&(m.answers=e.answers),void 0===m.correct&&(m.correct=e.correct),void 0===m.encode&&(m.encode=e.encode),void 0===m.input&&(m.input=e.input),void 0===m.no_feedback&&(m.no_feedback=e.no_feedback),ccm.helper.find(r,".current_question").html(ccm.helper.html(r.html.question,{question:ccm.helper.val(r.text_question),nr:n,text:ccm.helper.val(m.text,m.encode),caption:ccm.helper.val(r.text_answer),onsubmit:s})),i();for(var p=0;p<m.answers.length;p++)o(m.answers[p],p);r.lang.render()}var a={questions:e.questions.length,correct:0,details:[]};o.html(ccm.helper.html(r.html.main)),n(),s(),l(1),i&&i()})}}});